{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tatsuma/%E2%96%A0%E2%96%A0dev/management-plan/src/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { GoogleGenerativeAI } from '@google/generative-ai';\n\nexport async function generateManagementPlan(formData: FormData) {\n  const apiKey = process.env.GEMINI_API_KEY;\n  if (!apiKey) throw new Error(\"APIキーが見つかりません\");\n\n  const genAI = new GoogleGenerativeAI(apiKey);\n\n  // ▼▼▼ 自動切り替えリスト ▼▼▼\n  const modelCandidates = [\n    'gemini-2.0-flash-lite-preview-02-05', // ① 実績あり：最優先\n    'gemini-2.0-flash-exp',              // ② 予備\n    'gemini-1.5-flash',                  // ③ 標準\n    'gemini-1.5-flash-latest',           // ④ 予備\n    'gemini-flash-latest',               // ⑤ 汎用\n    'gemini-pro'                         // ⑥ 最後の砦\n  ];\n\n  // --- 入力項目の取得 ---\n  const industry = formData.get('industry') as string || '（未入力）';\n  const businessDetail = formData.get('businessDetail') as string || '（未入力）';\n  const hqLocation = formData.get('hqLocation') as string || '（未入力）';\n  const otherLocations = formData.get('otherLocations') as string || 'なし';\n  const businessArea = formData.get('businessArea') as string || '（未入力）';\n  const employeeCount = formData.get('employeeCount') as string || '（未入力）';\n  const futureEmployeeCount = formData.get('futureEmployeeCount') as string || '現状維持';\n  const strengths = formData.get('strengths') as string || '（未入力）';\n  const issues = formData.get('issues') as string || '（未入力）';\n  const newInitiatives = formData.get('newInitiatives') as string || '特になし';\n  const targetCustomers = formData.get('targetCustomers') as string || '（未入力）';\n  const acquisitionChannel = formData.get('acquisitionChannel') as string || '（未入力）';\n  const vision = formData.get('vision') as string || '（未入力）';\n\n  // ▼▼▼ プロンプト（数量指定・役割・視認性を全て統合した最終版） ▼▼▼\n  const prompt = `\nあなたは**世界最高の経営コンサルタント兼マーケッター兼編集者**です。\n私は社員20名以下の小規模企業の経営者です。\n私の会社の強みを最大限に活かし、読み手の心を動かす『経営計画書（全8章）』を作成してください。\n\n【★最重要指示：内容の質と量（コンサルタントとしての責任）】\n1. **数量の厳守**：SWOT分析は各要素3つ以上、クロスSWOTも各戦略3つ以上、第8章の施策は計50項目（5区分×10個）を必ず出力してください。数が足りない場合は不合格です。\n2. **省略・要約の禁止**：AIによくある「抽象的なまとめ」は禁止です。具体的かつ詳細に記述してください。\n3. **熱量のある文章**：形式的なビジネス文書ではなく、経営者の情熱が伝わる言葉を選んでください。\n\n【★出力形式：視認性の確保（編集者としての責任）】\nWordやメールに貼り付けてそのまま使えるよう、以下の「プレーンテキスト形式」を厳守してください。\n* **Markdown記号の禁止**：「#」「*」「-」「|」「**」などの記号は**絶対に使用しないでください**。\n* **表組み（テーブル）の禁止**：表は崩れるため使用せず、見やすい「リスト形式」で記述してください。\n* **見出しの統一**：大見出しは「■」、小見出しは「【 】」を使用してください。\n* **改行の徹底**：「見出し」の直後には必ず改行を入れ、本文を次の行から始めてください。\n\n【入力情報（ヒアリングシート）】\n1. 業種： ${industry}\n2. 事業内容の詳細： ${businessDetail}\n3. 本社所在地： ${hqLocation}\n4. その他拠点： ${otherLocations}\n5. 営業エリア（商圏）： ${businessArea}\n6. 現在の社員数： ${employeeCount}\n7. 5年後の希望社員数： ${futureEmployeeCount}\n8. 顧客から褒められる点（強み）： ${strengths}\n9. 困っている点（課題）： ${issues}\n10. これから新しくやりたいこと： ${newInitiatives}\n11. どんなお客様に来てもらっているか： ${targetCustomers}\n12. お客様の流入経路： ${acquisitionChannel}\n13. どんな会社にしていきたいか（想い）： ${vision}\n---------------------------\n\n■ 経営計画書の構成（全8章）\n1. 会社概要\n2. これから目指す姿（将来構想）\n3. 今の状況を知る（SWOT分析）： \n   ★表は使わずリスト形式で記述。\n   ★「強み」「弱み」「機会」「脅威」を**【各3項目以上】**必ず挙げてください。\n4. 分析を活かす作戦（クロスSWOT）： \n   ★表は使わず文章で記述。\n   ★「SO戦略」「WO戦略」「ST戦略」「WT戦略」を**【各3項目以上】**必ず提案してください。\n5. 私たちの立ち位置（戦略の優先順位）： ★後述のルールに基づきAIが分析・決定。\n6. 中期目標： 年度別に数値目標や状態目標を記述。\n7. 商圏・市場戦略： ターゲットやエリア戦略を具体的に。\n8. 戦略と施策： \n   ★5区分すべてにおいて、必ず**【10項目ずつ（計50項目）】**書き出してください。\n   ★単語ではなく、具体的な行動文章で書くこと。\n\n■ 第5章「私たちの立ち位置」の選択ルール（定義厳守）\n以下の定義に基づき、入力情報（${businessDetail}、${strengths}、${industry}）を分析し、最適な組み合わせを選んでください。\n**「答えありき」にならず、入力された事業内容と強みに最も適した戦略を選定してください。**\n\n[定義]\n* 商品：提供する物品、または**提供する役務（サービスそのもの）**の品質、機能、正確さ。\n* サービス：**契約や購入の前後に付随する対応の質**。マナー、フォロー体制、気配り。\n* 価格：市場相場との整合性や、納得感。\n* アクセス：物理的な利便性だけでなく、**専門的な解決策・情報への橋渡し（知的利便性）**を含む。\n* 経験価値：顧客が抱く安心感。（※構築難易度が高いため、今回は必ず基盤要素とする）\n\n[選択基準]\n1. 【最優先（市場支配レベル - 1つ）】\n   事業内容と強みを分析し、他社を圧倒できる要素（商品、価格、アクセス、サービスのいずれか）。\n   ※「経験価値」は最優先に選ばないこと。\n2. 【優先（差別化レベル - 1つ）】\n   2番目に強い要素。\n   ※「経験価値」はここにも選ばないこと。\n3. 【基盤（一般レベル - 3つ）】\n   残りの3つ。ここには必ず「経験価値」を含めること。\n\n■ 第8章「戦略と施策」の5区分（計50項目・省略禁止）\n1. 商品・サービスをどうするか\n2. お客様にどう伝えるか（営業・販促）\n3. 仕事の進め方と品質\n4. 働く仲間とチームづくり\n5. ムダをなくすデジタル活用\n\n--------------------------------------------------\n（以下、出力レイアウト見本。この形式を守り、中身は濃く記述すること）\n\n■ 第1章 会社概要\n\n【会社名】\n　（入力された会社名）\n\n【代表者】\n　（代表者名）\n\n■ 第3章 今の状況を知る（SWOT分析）\n\n【強み】\n1. 顧客対応のスピード\n　 大手には真似できない即日対応を徹底しており、顧客からの信頼が厚い。緊急時のトラブル対応においても、他社より平均2時間早く到着できている。\n\n2. ...（必ず3つ以上書く）\n\n--------------------------------------------------\n\n【出力後の案内】 \n計画書の本文が終わった後に、区切り線（--------------------------------------------------）を引き、必ず以下の形式で利用者への案内を出力してください。\n\n--------------------------------------------------\n【この経営計画書の使い方】\n\nこの計画書は、コピーしてそのままWordやドキュメントに貼り付けられる形式で作成しました。\n\n1. 保存方法\n   画面上に表示されている「全文をコピーする」ボタンを押してください。\n   計画書の内容がすべてコピーされますので、その後GoogleドキュメントやWordに貼り付けて保存してください。\n\n2. 活用のアドバイス\n   スライド資料にする場合は、この計画書を原稿として利用するか、専門業者への依頼資料としてご活用ください。\n\n3. 免責事項\n   本内容はAIが業界知識やヒアリング情報を基に作成した「参考情報」です。\n   売上高や利益計画などの詳細な「数値計画」は出力されません。\n   経営実態と異なる箇所がないかご自身で確認・修正し、最終的な判断は利用者様の責任において行ってください。\n`;\n\n  let lastError = null;\n\n  for (const modelName of modelCandidates) {\n    try {\n      const model = genAI.getGenerativeModel({ model: modelName });\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      return response.text();\n    } catch (error: any) {\n      console.warn(`⚠️ モデル ${modelName} は使用できませんでした。次を試します...`);\n      lastError = error;\n    }\n  }\n\n  console.error(\"全モデル全滅:\", lastError);\n  throw new Error(\"現在、アクセス集中により応答しづらくなっています。恐れ入りますが、しばらく時間（1〜2分程度）を空けてから、再度お試しください。\");\n}"],"names":[],"mappings":";;;;;AAEA;;;;AAEO,eAAe,uBAAuB,QAAkB;IAC7D,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IACzC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAE7B,MAAM,QAAQ,IAAI,oLAAkB,CAAC;IAErC,oBAAoB;IACpB,MAAM,kBAAkB;QACtB;QACA;QACA;QACA;QACA;QACA,aAAqC,SAAS;KAC/C;IAED,kBAAkB;IAClB,MAAM,WAAW,SAAS,GAAG,CAAC,eAAyB;IACvD,MAAM,iBAAiB,SAAS,GAAG,CAAC,qBAA+B;IACnE,MAAM,aAAa,SAAS,GAAG,CAAC,iBAA2B;IAC3D,MAAM,iBAAiB,SAAS,GAAG,CAAC,qBAA+B;IACnE,MAAM,eAAe,SAAS,GAAG,CAAC,mBAA6B;IAC/D,MAAM,gBAAgB,SAAS,GAAG,CAAC,oBAA8B;IACjE,MAAM,sBAAsB,SAAS,GAAG,CAAC,0BAAoC;IAC7E,MAAM,YAAY,SAAS,GAAG,CAAC,gBAA0B;IACzD,MAAM,SAAS,SAAS,GAAG,CAAC,aAAuB;IACnD,MAAM,iBAAiB,SAAS,GAAG,CAAC,qBAA+B;IACnE,MAAM,kBAAkB,SAAS,GAAG,CAAC,sBAAgC;IACrE,MAAM,qBAAqB,SAAS,GAAG,CAAC,yBAAmC;IAC3E,MAAM,SAAS,SAAS,GAAG,CAAC,aAAuB;IAEnD,uCAAuC;IACvC,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;OAkBX,EAAE,SAAS;YACN,EAAE,eAAe;UACnB,EAAE,WAAW;UACb,EAAE,eAAe;cACb,EAAE,aAAa;WAClB,EAAE,cAAc;cACb,EAAE,oBAAoB;mBACjB,EAAE,UAAU;eAChB,EAAE,OAAO;mBACL,EAAE,eAAe;sBACd,EAAE,gBAAgB;cAC1B,EAAE,mBAAmB;uBACZ,EAAE,OAAO;;;;;;;;;;;;;;;;;;;;eAoBjB,EAAE,eAAe,CAAC,EAAE,UAAU,CAAC,EAAE,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEzD,CAAC;IAEC,IAAI,YAAY;IAEhB,KAAK,MAAM,aAAa,gBAAiB;QACvC,IAAI;YACF,MAAM,QAAQ,MAAM,kBAAkB,CAAC;gBAAE,OAAO;YAAU;YAC1D,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;YAC3C,MAAM,WAAW,MAAM,OAAO,QAAQ;YACtC,OAAO,SAAS,IAAI;QACtB,EAAE,OAAO,OAAY;YACnB,QAAQ,IAAI,CAAC,CAAC,OAAO,EAAE,UAAU,sBAAsB,CAAC;YACxD,YAAY;QACd;IACF;IAEA,QAAQ,KAAK,CAAC,WAAW;IACzB,MAAM,IAAI,MAAM;AAClB;;;IAvKsB;;AAAA,+OAAA"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///Users/tatsuma/%E2%96%A0%E2%96%A0dev/management-plan/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateManagementPlan as '402de835c6f2b7e0fd639fbdf46f55bf2fe54478bf'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///Users/tatsuma/%E2%96%A0%E2%96%A0dev/management-plan/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@google/generative-ai/dist/index.mjs","sources":[],"sourcesContent":[],"names":[],"mappings":""}},
    {"offset": {"line": 1746, "column": 0}, "map": {"version":3,"sources":["file:///Users/tatsuma/%E2%96%A0%E2%96%A0dev/management-plan/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}